# Case-study оптимизации

### Добавил необходимые гемы для профилирования:
- bullet
- rack-mini-profiler
- pghero
- fasterer

### Находка №1
- `gem bullet` обнаружил N + 1: `Add to your query: .includes([:bus])`
- добавил `preload(bus: :services)`
- исправленна проблема N + 1
- скорость отображения страницы изменилась с `1487 ms` до `205 ms`

### Находка №2
- загрузил файл `medium.json`
- посмотрел rails model dependency diagram
- добавил модель `BusesService`
- скорость отображения страницы изменилась с `1473 ms` до `725 ms`

### Находка №3
- решил посмотреть код внимательнее, перед этим запустив `rubocop --require rubocop-performance`
- сделал небольшой рефакторинг, переделал рендер
- скорость отображения страницы изменилась с `725 ms` до `526 ms`

### Находка №4
- для чтения json файла выбрал `gem json-streamer`
- для записи в postgres выбрал `gem activerecord-import`
- сделал два сервиса для работы с таской
  - `TruncateService` - сервис который делает truncate для таблиц
  - `WriteDumpService` - сервис который обрабатывает файл и записывает данные
- время выполнения такски для `small.json` уменьшилась до `1.3 sec`

### Находка №5
- добавил индексы
- время отображения страницы уменьшилось до `89 ms`