# Case-study оптимизации

## Оптимизация импорта
Изначально время импорта файла large.json занимало ~450s
Я переписал импорт сразу с потоковой записью в `Postgres`. После рефакторинга время обарботки файла large.json стало ~13s

## Оптимизация рендеринга страницы
Изначальное время рендеринга страницы с данными из файла large.json было ~34000ms.

### Правка №1
bullet и rack mini profiler указывали на проблему n+1
Добавил includes к формированию списка поездок:
@trips = Trip.includes(bus: :services).where(from: @from, to: @to).order(:start_time)
После рефакторинга время рендера страницы изменилось с ~34000ms до ~24000ms

### Правка №2
Rails panel указвыл, что практически все время тратиться на рендеринг шаблонов. Решил убрать все шаблоны и формировать html сразу на одной странице, тк он достаточно простой.
После рефакторинга время рендера страницы изменилось с ~24000ms до ~6000ms

### Правка №3
Решил установить pg_hero и проанализировать запросы. pg_hero не предлавагал добавлять никакие индексы и все было в норме. Но я добавил индыксы на имя города, и составной индекс для трипов по from_id, to_id. Какой-то прибавки к скорости рендера это не дало, все осталось в пределах погрешности.

### Правка №4
Принял решение добавить кэширование. Закэшировал сразу всю страницу index. Время рендера закешированной версии страницы изменилось с ~6000ms до ~250ms
