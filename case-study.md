## 1. Оптимизация загрузки данных в базу приложения

#### Проблема 
Рейк-таск для загрузки данных в базу приложения работает слишком долго: ~8 секунд для файла с 1_000 записей, ~67 секунд для файла с 10_000 записей. 

#### Метрика
Чтобы понять, несут ли изменения положительный эффект, в качестве метрики выбрано время загрузки файлов поставляемых с программой. Также в процессе оптимизации планирую следить за потреблением памяти.

#### Гарантия корректности работы программы
Для гарантии корректной работы написан тест проверяющий что в базу корректно загружается файл `fixtures/example.json`

#### Feedback-loop
Для получения быстрой обратной связи добавлены скрипты генерации отчетов профилировщиков.

#### Процесс оптимизации (WIP)
В исходном состоянии скрипт загрузки имеет следующие показатели для файла small.json (1к записей, размер ~304K)
Потребление памяти (вместе со всем rails приложением)
```
Total allocated: 467.01 MB (4716422 objects)
Total retained:  10.68 MB (9833 objects)
```
Время работы - ~9 сек

Ruby-prof по времени не показал точек роста - отчет в основном состоит из внутренностей Rails.

Собрал лог из базы данных и скормил его pgbadger - оказалось что для вставки 1_000 записей выполняется 13_528 запросов к базе.  
Из них 68% (9_253) это SELECT, т.е. даже не вставка данных. Несложно было догадаться что основная масса из них это проверка "справочников" и валидации AR выполняемые при сохранении данных.  
Решил сделать как было предложено в подсказках к заданию - использовать гем `activerecord-import` а также собрать справочники и загрузить их одной пачкой.

Благодаря этим действиям удалось значительно снизить время загрузки данных :  
Без AR валидаций small.json - ~1.1 секунд, large.json - ~7.7 секунд  
С AR валидациями small.json - ~1.3 секунд, large.json - ~18.4 секунд  
(данные, включая время старта окружения)

Потребление памяти также сократилось:   
small.json:
```
Total allocated: 24.79 MB (159304 objects)
Total retained:  10.61 MB (9125 objects)
```
large.json
```
Total allocated: 710.76 MB (5513967 objects)
Total retained:  10.61 MB (9120 objects)
```
Естественно что без стриминга мы грузим в память файл который обрабатываем целиком, но bonus часть я не выполнял, так что оставляю как есть.

#### Результат (WIP)
В результате проведенной оптимизации удалось уложиться в рамки задачи.

#### Защита от регрессии (WIP)
Для защиты от регрессии добавлен тест, который проверяет время загрузки файла с 1к записей.
