## Задача 1: Импорт данных
Нужно оптимизировать механизм перезагрузки расписания из файла так, чтобы он импортировал файл _large.json_ в БД posgresql в пределах минуты

# Ход выполнения
Сразу было видно, даже без профилировщиков, что под каждую запись в бд делается отдельный INSERT запрос - это занимает основную часть времени.
Нужно применить подход с BATCH INSERT. Для этого использовался гем **activerecord-import**. Основная проблема была импортировать связи, т.к
требуется внешний ключ, т.е знание id непосредственно на уровне бд. Чтобы не делать лишних SELECT запросов, использовал хранение id автобусов, городов и сервисов в хеше на уровне оперативной памяти (хеш обновлялся каждый раз при добавлении новых объектов в базу)

Также добавлял индексы (в том числе и составные) на уникальность, т.к при BATCH INSERT возможно появления дубликатов и нужна валидация на уровне бд

# Результат
Для оценки скорости работы рейк таски использовал библиотеку Benchmark

```
bundle exec rake reload_json[fixtures/large.json]

Total time is: 21.044087463000324
```

-> получилось добиться импорта файла _large.json_ за +- 20 секунд


## Задача 2: Отображение расписаний
Сами страницы расписаний тоже формируются не эффективно и при росте объёмов начинают сильно тормозить.

Нужно найти и устранить проблемы, замедляющие формирование этих страниц

Предварительно импортирован файл _large.json_

# Ход выполнения
Для оценки скорости работы загрузки страницы использовал гем **rack-mini-profiler**

### Находка №1
- видна проблема n+1 при прогрузке ассоциаций в index.html.erb `trip.bus.services`
- Добавил `preload` в контроллер
- рендер страницы ускорился с 5 секунд до 2.7 секунд

### Находка №2
- видна долгая загрузка partial _trip.html.erb и _service.html.erb
- удалил конструкцию с `@trips.each` и переписал на более быстрый подход рендера с конструкцией `render partial: "trip", collection: @trips`
- аналогично для сервисов: `<%= render partial: "service", collection: trip.bus.services %>`
- рендер страницы ускорился с 2.7 секунд до 500мс

### Находка №3
- Делался лишний запрос `SELECT COUNT(*)` - исправил вызов `.count` на `.length` на @trips

### Находка №4
- Рендер вьюх всё ещё занимал основное время
- Дропнул ненужную вьюху `_delimiter.html.erb` и просто вставил текст из неё в родительскую вьюху `_trip.html.erb`
- рендер страницы ускорился с 500мс до 260мс

# Результат
Для оценки скорости смотрел девелопмент лог и вывод гема rack-mini-profiler

```
Completed 200 OK in 263ms (Views: 235.8ms | ActiveRecord: 25.0ms)

```

-> получилось добиться открытия страницы за 263мс
