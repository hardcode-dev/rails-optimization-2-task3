# A. Импорт данных
Обработка  medium файла занимает ~ 1мин40сек, по памяти - 111MB

Сразу же приступил к переписанию на потоковую обработку, выделил код в класс в app/services/reload_json.rb, добавил frozen string literal, все инсерты в таблицы заменил на импорты
После оптимизации обработак medium файла - ~ 1 сек, память - 87 MB

Обработка large.json - ~ 7.6 сек, память - 87MB

Обработка 1M.json - ~ 68 сек, память - 116MB

По отчетам профилировки по CPU и памяти не нашел точек для оптимизации
# Б. Отображение расписаний
Начну с rack-mini-profiler

Без профилировщика страница с 1004 трипов загружается за 3.4 секунды, с профилировщиком - 19 сек

Профилировщик показал 450 запросов в app/views/trips/index.html.erb, добавил ```includes``` моделей в app/controllers/trips_controller.rb, заменил @trips.count на @trips.size

Теперь страница загружается за 11.4 сек, кол-во запросов сократилось до 6

Судя по логам и профилировщику большинство времени уходит на рендер паршалов, об этом же говорит и rails panel
![Alt text](<images/Screenshot from 2023-11-06 16-52-17.png>)
Перенес весь код касаемый одного трипа в паршал, избавился от рендера остальных паршалов, результат
![Alt text](<images/Screenshot from 2023-11-06 18-32-17.png>)
Общее время запроса в среднем 315ms

Считаю на этом можно остановиться, т.к. улучшение запросов почти не принесет пользы, а импорты могут замедлиться из-за добавления индексов

